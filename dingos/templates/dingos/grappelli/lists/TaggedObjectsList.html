{% extends "dingos/grappelli/lists/base_lists_one_column.html" %}

{% load dingos_tags %}

{% load tagging_widgets %}



{% block content %}
  <div class="c-2">
  {% show_TaggedThings tag=tag  %}

    <div class="grp-module">
      <h2 class="grp-collapse-handler">{% block list_title %}Objects tagged with "{{ tag }}"{% endblock %}</h2>
        {% for model,items in model_objects_mapping.items %}
        {% if items %}
          <div class="grp-module grp-collapse grp-open">
            <h3 class="grp-collapse-handler">{{ model }}</h3>
              {% if model == 'Identifier' %}
                <table>
                {% for item in items %}
                  <tr>
                    <td>{{ item.1 }}</td>
                    <td><a href="{% url "url.dingos.view.infoobject" item.2 %}">{{ item.0 }}</a></td>
                  </tr>
                {% endfor %}
                </table>

              {% elif model == "Fact" %}
                {% if view.display == 'factdetails' %}
                {% for item in items %}
                  <div class="grp-module grp-collapse grp-open">
                    <h3 class="grp-collapse-handler">
                      {% if item.1 %}
                         {{ item.0 }}@{{ item.1 }}
                      {% else %}
                         {{ item.0 }} = {{ item.2 }}
                      {% endif %}
                    </h3>
                    <table>
                      <tr>
                        <td>Parent Infoobject </td>
                        <td>Top-Level-Package</td>
                      </tr>
                      {% for parent_id in fact2parent|get_value:item.3 %}
                      {% with parent_info=iobj2nodeinfo|get_value:parent_id %}
                        <tr>
                          <td>
                            <a href="{%url 'url.dingos.view.infoobject' pk=parent_id %}">
                            {% show_namespace_image parent_info.0 height='25' %}:{{ parent_info.1 }}</a>
                            <br/>
                            {{ parent_info.2 }}
                          </td>
                          <td>
                            {% for toplevel_id in parent2toplevel|get_value:parent_id %}
                            {% with toplevel_info=iobj2nodeinfo|get_value:toplevel_id %}
                              <a href="{%url 'url.dingos.view.infoobject' pk=toplevel_id %}">{% show_namespace_image toplevel_info.0 height='25' %}:{{ toplevel_info.1 }}</a>
                              {{ toplevel_info.2 }}
                              {% if not forloop.last %},<br/>{% endif %}
                            {% endwith %}
                            {% endfor %}
                          </td>
                        </tr>
                      {% endwith %}
                      {% endfor %}
                    </table>
                  </div>
                {% endfor %}

                {% else %}
                  <table>
                  {% for item in items %}
                    <tr>
                      <td>{{ item.0 }}{% if item.1 %}{{ item.1 }}{% endif %}</td>
                      <td>{{ item.2 }}</td>
                    </tr>
                  {% endfor %}
                  </table>
                {% endif %}
              {% endif %}
          </div>
        {% endif %}
        {% endfor %}
    </div>
  </div>
{% endblock %}