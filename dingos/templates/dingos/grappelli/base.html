{% extends "mantis/grappelli/base.html" %}

{% comment %}
Copyright (c) Siemens AG, 2013

This file is part of MANTIS.  MANTIS is free software: you can
redistribute it and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either version 2
of the License, or(at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 51
Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
{% endcomment %}


{% load static %}
{% load dingos_tags %}

{% block title %}
  {% create_title title %}
{% endblock %}

{% block stylesheets %}
  {{ block.super }}
  <link href="{% static 'dingos/css/django-dingos.css' %}" rel="stylesheet" type="text/css" media="screen" />
{% endblock %}

{% block javascripts %}
  {{ block.super }}
  <script type="text/javascript" charset="utf-8">
    var $ = django.jQuery;
    var jQuery = django.jQuery;
  </script>
  <script src="{% static 'dingos/js/django-dingos.js' %}"></script>
  <script type="text/javascript" charset="utf-8">
(function($) {
    function add_removeHandler() {
        $('.remove_tag_button').click(function (event) {
            var tag_name = $(event.target).data('tag-name');
            var obj_id = $(event.target).data('iobject-id');
            $.post("", { action: "remove", tag: tag_name, object : obj_id});
            if((obj_id != null) && ($(event.target).parent().siblings().length == 0))
            {
                $(event.target).parent().parent().remove();
            }
            else
            {
                $(event.target).parent().remove();
            }
        });
    }

    $(document).ready(function () {
        add_removeHandler();
        $('.add_tag_button').click(function (event) {
            var tag_name = $(event.target).parent().children("input#id_tag").val();
            if(tag_name != "" && $(event.target).parent().siblings("#tags").children("span#" + tag_name).length == 0) {
                var obj_id = $(event.target).data('object');
                $.ajax({
                    url: "",
                    type: "POST",
                    data: { action: "add", tag: tag_name, object: obj_id} ,
                    dataType: "json",
                    success: function (resp) {
                        var tag = '<span id="' + resp.name + '" class="tag">' + resp.name + '<a href="#" class="remove_tag_button" data-tag-name="' + resp.name + '"> X</a></span>';
                        if($('table#result_list').length) {
                            $(event.target).parent().siblings("#tags").append(tag);
                        }
                        else {
                            $('td#tags').append(tag);
                        }

                        add_removeHandler();
                    }
                });
            }
        });
    });
})(django.jQuery);
  </script>
{% endblock javascripts %}

{% block content_title %}
  <h1>{{ title }}</h1>
{% endblock %}

