{% extends "mantis/grappelli/base.html" %}

{% comment %}
Copyright (c) Siemens AG, 2013

This file is part of MANTIS.  MANTIS is free software: you can
redistribute it and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either version 2
of the License, or(at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 51
Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
{% endcomment %}


{% load static %}
{% load dingos_tags %}

{% block title %}
  {% create_title title %}
{% endblock %}

{% block stylesheets %}
  {{ block.super }}
  <link href="{% static 'dingos/css/django-dingos.css' %}" rel="stylesheet" type="text/css" media="screen" />
{% endblock %}

{% block javascripts %}
  {{ block.super }}
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.js" type="text/javascript"></script>
  {% include 'autocomplete_light/static.html' %}
  <script src="{% static 'dingos/js/django-dingos.js' %}"></script>
  <script type="text/javascript" charset="utf-8">
(function($) {
    $(document).ready(function () {
        // Tagging Ajax
        $('.remove_tag_button').click(function (event) {
            var tagid = $(event.target).data('tag-id');
            var objid = $(event.target).data('iobject-id');
            $.post("", { action: "remove", tag: tagid, object : objid});
            $('span#' + tagid).remove();
            if($('#tags').children().length == 0)
            {
                $('#tags').remove();
            }
        });

        $('.add_tag_button').click(function () {
            var tagid = $("#id_tag").val();
            if (tagid == null || $("span#" + tagid).length == 0) {
                $.ajax({
                    url: "",
                    type: "POST",
                    data: $('#tagform_add').serialize(),
                    dataType: "json",
                    success: function (resp) {
                        var tag = '<span id="' + resp.id + '" class="tag">' + resp.name + '<a href="#" class="remove_tag_button" id="' + resp.id + '"> X</a></span>';
                        $('#tags').append(tag);
                    }
                });
                if (tagid != null) {
                    $('span#id_tag-deck .remove').click();
                }

            }
        });
    });
})(django.jQuery);
  </script>
{% endblock javascripts %}

{% block content_title %}
  <h1>{{ title }}</h1>
{% endblock %}

