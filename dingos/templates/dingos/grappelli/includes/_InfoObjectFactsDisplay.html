{% comment %}
Copyright (c) Siemens AG, 2013

This file is part of MANTIS.  MANTIS is free software: you can
redistribute it and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either version 2
of the License, or(at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 51
Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
{% endcomment %}


{% load dingos_tags %}


{% block fact %}

   {% if formset and formindex %}
     <form id="infoobject-edit" action="" method="post">{% csrf_token %}
     {{ formset.management_form }}
   {% endif %}

    <div class="grp-module grp-collapse grp-{{fold_status}}">
        <h{{ header_level }} class="grp-collapse-handler">{{ title }}</h{{ header_level }}>

        {%  if is_paginated %}
            {%  render_paginator %}
        {% endif %}
        <div class="grp-module grp-collapse grp-open">

            <table>


                {% for k in iobject2facts %}
                    {% if forloop.first %}
                        <tr class="grp-collapse-handler">
                        {% if show_NodeID %}
                        <td></td>
                        {% endif %}
                            <th colspan='100'>

                            </th>
                        {% if show_datatype %}
                            <th >
                                Datatype
                            </th>
                        {% endif %}
                        </tr>
                    {% endif %}

                    <tr >
                    {% if show_NodeID%}
                    <td>{{k.node_id}}</td>
                    {% endif %}
                    {%     node_indent "td"  k.node_id.name k.fact.fact_term.term k.fact.fact_term.attribute highlight %}

                            <a name="{{ k.node_id }}"> </a>
                        {% if k.fact.value_iobject_id %}
                            {%  if k.fact.value_iobject_id.latest %}
                            <a href={% url 'url.dingos.view.infoobject' k.fact.value_iobject_id.latest.pk %}>
                                <img src="/static/admin/img/selector-search.gif" alt="Lookup" height="16" width="16">
                            </a>
                                {% if k.fact.value_iobject_id.latest.name == '' or k.fact.value_iobject_id.latest.name == 'PLACEHOLDER' %}
                                    {{k.fact.value_iobject_id.latest.iobject_type.name}}
                                {% else %}
                                    {{k.fact.value_iobject_id.latest.name}}
                                {% endif %}
                            {%  else %}
                                {{ k.fact.value_iobject_id.namespace.uri }}:{{ k.fact.value_iobject_id.uid }}
                            {% endif %}
                        {% else %}
                            {%  for value in k.fact.fact_values.all %}
                                {% if value.storage_location == 1 %}
                                    On Disk: {{ value.value }}
                                {% elif value.storage_location == 2 %}
                                    {%  lookup_blob value.value %}
                                {% elif k.node_id.name in formindex %}
                                    {% render_formset_form formset formindex k.node_id.name 'value' %}
                                {% else %}
 			                        {{ value.value }}
                                {% endif %}

                                {%  if not forloop.last %}
                                  ,<br/>
                                {% endif %}

                            {% endfor %}


                        {% endif %}

                    {%     node_indent_end "td"  k.node_id.name k.fact.fact_term.term k.fact.fact_term.attribute %}
                    {% if show_datatype %}
                    <td >
                         {{k.fact.fact_values.all.0.fact_data_type.name}}
                    </td>
                    {% endif %}
                {% endfor %}
            </table>
        </div>

        {%  if is_paginated %}
            {%  render_paginator %}
        {% endif %}


    </div>

  {% if formset and formindex %}
    <footer class="grp-module grp-submit-row grp-fixed-footer">
    <header style="display:none"><h1>Submit Options</h1></header>
      <ul><li><input class="grp-button grp-default" type="submit" value="Save"></input></li></ul>
    </footer>
  </form>
  {% endif %}
{% endblock %}
