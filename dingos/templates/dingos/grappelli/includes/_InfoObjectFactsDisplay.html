{% comment %}
Copyright (c) Siemens AG, 2013

This file is part of MANTIS.  MANTIS is free software: you can
redistribute it and/or modify it under the terms of the GNU General Public
License as published by the Free Software Foundation; either version 2
of the License, or(at your option) any later version.

This program is distributed in the hope that it will be useful, but WITHOUT
ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more
details.

You should have received a copy of the GNU General Public License along with
this program; if not, write to the Free Software Foundation, Inc., 51
Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
{% endcomment %}


{% load dingos_tags %}


{% block fact %}

   {% if formset and formindex %}
     <form id="infoobject-edit" action="" method="post">{% csrf_token %}
     {{ formset.management_form }}
   {% endif %}

    <div class="grp-module grp-collapse grp-{{fold_status}}">
        <h{{ header_level.0 }} class="grp-collapse-handler">
            {{ title }}
            {%  if link_pk %}
             <a href={% url 'url.dingos.view.infoobject' pk=link_pk %}>
              <img src="/static/admin/img/selector-search.gif" alt="Lookup" height="16" width="16">
             </a>
            {% endif %}
        </h{{ header_level.0 }}>

        {%  if is_paginated %}
            {%  render_paginator %}
        {% endif %}

        {% if inner_collapsible %}
        <div class="grp-module grp-collapse grp-{{ inner_fold_status }}">
            <h{{ header_level.1 }} class="grp-collapse-handler">{{ inner_collapsible }}</h{{ header_level.1 }}>
        {% endif %}
            <table>


                {% for k in iobject2facts %}
                    {% if False %}
                        <tr>
                        {% if show_NodeID %}
                        <td></td>
                        {% endif %}
                            <th colspan='100'>

                            </th>
                        {% if show_datatype %}
                            <th >
                                Datatype
                            </th>
                        {% endif %}
                        </tr>
                    {% endif %}

                    <tr>
                    {% if show_NodeID%}
                    <td>{{k.node_id}}</td>
                    {% endif %}
                    {%     node_indent "td"  k.node_id k.term k.attribute highlight %}

                            <a name="{{ k.node_id }}"> </a>
                        {% if k.referenced_iobject_identifier_id %}
                            {%  if k.referenced_iobject_identifier.latest %}
			    {% url 'url.dingos.view.infoobject' k.referenced_iobject_identifier.latest.pk as ref_obj_url %}
			    {% if ref_obj_url %}
                            <a href="{{ref_obj_url}}">
			      
                              <img src="/static/admin/img/selector-search.gif" alt="Lookup" height="16" width="16">

                            </a>
			    {% endif %}

                                {% if k.referenced_iobject_identifier.latest.name == '' or k.referenced_iobject_identifier.latest.name == 'PLACEHOLDER' %}
                                    {{k.referenced_iobject_id.latest.iobject_type.name}}
                                {% else %}
                                    {{k.referenced_iobject_identifier.latest.name}}
                                {% endif %}
                            {%  else %}
                                {{ k.referenced_iobject_identifier.namespace.uri }}:{{ k.referenced_iobject_identifier.uid }}
                            {% endif %}
                        {% else %}
                            {%for value in k.value_list %}
                                {% if k.value_storage_location == 1 %}
                                    On Disk: {{ k.value }}
                                {% elif k.value_storage_location == 2 %}
                                    {%  lookup_blob value %}
                                {% elif k.node_id in formindex %}
                                    {% render_formset_form formset formindex k.node_id 'value' %}
                                {% else %}
 			                        {{ value }}
                                {% endif %}

                                {%  if not forloop.last %}
                                  ,<br/>
                                {% endif %}

                            {% endfor %}


                        {% endif %}

                    {%     node_indent_end "td"  k.node_id k.term k.attribute %}
                    {% if show_datatype %}
                    <td >
                         {{k.fact.fact_values.all.0.fact_data_type.name}}
                    </td>
                    {% endif %}
                    {% with tags=tag_dict|get_value:k.iobject_id|get_value:k.fact_id %}
                      <td id="tags" class="w-1 nowrap middle" data-obj-id="{{ k.fact_id }}" data-obj-type="Fact">
                        {% show_addTagInput k.fact_id "Fact" %}
                        {% if tags %}
                          {% show_TagDisplay tags k.fact_id True %}
                        {% endif %}
                      </td>
                    {% endwith %}
                    </tr>
                {% endfor %}
            </table>
        {% if inner_collapsible %}
        </div>
        {% endif %}
        {%  if is_paginated %}
            {%  render_paginator %}
        {% endif %}

  {% if close_div %}
    </div>
  {% endif %}

  {% if formset and formindex %}
    <footer class="grp-module grp-submit-row grp-fixed-footer">
    <header style="display:none"><h1>Submit Options</h1></header>
      <ul><li><input class="grp-button grp-default" type="submit" value="Save"></input></li></ul>
    </footer>
  </form>
  {% endif %}
{% endblock %}
